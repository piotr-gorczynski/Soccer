rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Invitations: only the invitee can read or accept it
    match /invitations/{invId} {
      allow read:  if request.auth.uid == resource.data.to;
      allow write: if false;  // only your Callable can update status
    }

    // Matches: only the two players can read or write
    match /matches/{matchId} {
      allow create: if request.auth.uid == request.resource.data.player0
                 && request.resource.data.player1 is string;  
      allow read, update, delete:
          if request.auth.uid == resource.data.player0
          || request.auth.uid == resource.data.player1;

      // Moves: participants may read past moves and add new ones
      match /moves/{moveId} {
        allow create: if request.auth.uid == resource.parent.data.player0
                    || request.auth.uid == resource.parent.data.player1;
        allow read:   if request.auth.uid == resource.parent.data.player0
                    || request.auth.uid == resource.parent.data.player1;
      }
    }

    // (Optional) block everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
